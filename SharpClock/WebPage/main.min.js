function pauseButton(n){$("#pauseBtn").html(n==!0?"Module auto switch<i class='material-icons right'>play_arrow<\/i>":"Module auto switch <i class='material-icons right'>pause<\/i>");n==!0?($("#pauseBtn").removeClass("green"),$("#pauseBtn").addClass("yellow darken-3")):($("#pauseBtn").removeClass("yellow darken-3"),$("#pauseBtn").addClass("green"))}function SerializeForm(n){let t=$(n).find('input:not([type="checkbox"])').serialize(),i=$(n).find('input[type="checkbox"]').map(function(){return this.name+"="+this.checked}).get().join("&");t+=i!=""&&t!=""?"&"+i:i;t=t.split("&");const r={};return t.forEach(function(n){n=n.split("=");r[n[0]]=decodeURIComponent(n[1])}),r}function mapValue(n,t,i,r,u){return Math.round((n-t)*u/i+r)}$(function(){function i(){$("#Loader").show();$.post("getModules",function(t){$("#moduleList").html("");console.log(t.Response);t.Response.forEach(function(t){let i=`<form class="noActionForm" method="POST" action="">`;i+=`<input type="hidden" name="Module" value="${t.Name}"/>`;i+=`<p><label>${n.module}</label>`;i+=`<div class="switch"><label for="${t.Name}_Power">`;i+=`${n.off}`;i+=`<input type="checkbox" id="${t.Name}_Power" name="Power" ${t.Status=="started"?"checked":""} />`;i+=`<span class="lever"></span>`;i+=`${n.on}`;i+=`</label></div></p><br />`;t.Values.forEach(function(r){let u=`<p>`,f;try{f=r.VisibleName.find(t=>t.lang==n.languageName).value}catch(e){try{f=r.VisibleName.find(n=>n.lang=="en").value}catch(e){f=r.Name}}if(r.type=="Int32"||r.type=="float")u+=`<label for="${t.Name}_${r.Name}">`,u+=`<span>${f}</span>`,u+=`<input type="number" id="${t.Name}_${r.Name}" name="${r.Name}" value="${r.Value}" />`,u+=`</label>`;else if(r.type=="Boolean")u+=`<label>${f}</label>`,u+=`<div class="switch"><label for="${t.Name}_${r.Name}">`,u+=`Off`,u+=`<input type="checkbox" id="${t.Name}_${r.Name}" name="${r.Name}" ${r.Value=="True"?"checked":""} />`,u+=`<span class="lever"></span>`,u+=`On`,u+=`</label></div>`;else if(r.type=="String")u+=`<label for="${t.Name}_${r.Name}">`,u+=`<span>${f}</span>`,u+=`<input type="text" id="${t.Name}_${r.Name}" name="${r.Name}" value="${r.Value}" />`,u+=`</label>`;else if(r.type=="Enum"){let i=r.options.split(",");u+=`<label>${f}</label><br/>`;i.forEach(function(i){let f;try{f=r.visibleOptions.find(t=>t.lang==n.languageName).values;f=f.find(n=>n.split("=")[0]==i).split("=")[1]}catch(e){try{f=r.visibleOptions.find(n=>n.lang=="en").value;f=f.find(n=>n.split("=")[0]==i).split("=")[1]}catch(e){f=i}}u+=`<label for="${t.Name}_${r.Name}_${i}">`;u+=`<input type="radio" id="${t.Name}_${r.Name}_${i}" name="${r.Name}" value="${i}" ${r.Value==i?`checked`:""} />`;u+=`<span>${f}</span>`;u+=`</label>`;u+=`<br />`})}else r.type=="Color"?(u+=`<label>${f}</label><br/>`,u+=`<label for="${t.Name}_${r.Name}">`,u+=`<input type="color" id="${t.Name}_${r.Name}" name="${r.Name}" value="${r.Value}"/>`,u+=`</label>`,u+=`<br />`):r.type=="TimeSpan"&&(u+=`<label>${f}</label><br/>`,u+=`<label for="${t.Name}_${r.Name}">`,u+=`<input type="time" id="${t.Name}_${r.Name}" name="${r.Name}" value="${r.Value}"/>`,u+=`</label>`,u+=`<br />`);u+="<\/p><br />";i+=u});i+=`<div class="right-align">`;i+=`<button type="button" class="waves-effect waves-light btn yellow darken-3" id="${t.Name}_reloadBtn"><span class="material-icons right">refresh</span></button>`;i+=`<button type="button" class="waves-effect waves-light btn green darken-3" id="${t.Name}_switchtoBtn"><span class="material-icons right">visibility</span></button>`;i+=`</div>`;i+=`</form>`;const r=`
                    <li>
                        <div class="collapsible-header">
                            <i class="material-icons">${t.Icon}</i>
                            ${t.Name}
                            <span id="${t.Name}_isRunning" class="badge ${t.Status=="started"?"green":"red"}-text"><span style="font-weight:bold" class="material-icons">power_settings_new</span></span>
                        </div>
                        <div class="collapsible-body white">
                            ${i}
                        </div>
                    </li>`;$("#moduleList").append(r);$(`#${t.Name}_reloadBtn`).click(function(){$("#Loader").show();$.post("reloadModule",{name:t.Name},function(){$("#Loader").hide()})});$(`#${t.Name}_switchtoBtn`).click(function(){$("#Loader").show();$.post("switchModule",{name:t.Name,pause:!0},function(n){n.Response.Error&&alert("Module is disabled!");pauseButton(n.Response.Pause);$("#Loader").hide()},"JSON")})});$(".fixed-action-btn").floatingActionButton({direction:"left"});$(".noActionForm").submit(function(n){n.preventDefault();$("#Loader").show();const t=SerializeForm(this);$.post("modifyModuleSettings",t,function(n){n.Response.Status?$("#"+n.Response.Name+"_isRunning").removeClass("red-text").addClass("green-text"):$("#"+n.Response.Name+"_isRunning").removeClass("green-text").addClass("red-text");$("#Loader").hide()},"JSON")});$(".noActionForm :input").change(function(){$(this).submit()});$("#Loader").hide()},"JSON")}function r(){$("#AppInstall_Save").click(function(){$("#Loader").show();const n=$("#AppInstall_File")[0].files;if(console.log(n),n.length>0){const t=new FormData;t.append("file",n[0],n[0].name);$.ajax({type:"POST",contentType:!1,cache:!1,processData:!1,url:"AppInstall",dataType:"json",data:t}).done(n=>{console.log(n)}).always(()=>{$("#Loader").hide(),alert("Upload Complete")})}else $("#Loader").hide()})}function u(){$("#Loader").show();$.post("GetDlls",function(n){$("#InstaledDll").html("");n.Response.forEach(n=>{$("#InstaledDll").append(`<li class="collection-item"><div>${n}<a href="#!" class="secondary-content"><i class="material-icons">delete</i></a></div></li>`)});$("#Loader").hide()},"JSON")}function f(){$("#brightnessControl").mousemove(function(){const n=$(this).val();$("#brightnessValue").html(n+"%")});$.post("getProperties",function(n){const t=mapValue(n.Response.Brightness,2,32,0,100);$("#brightnessControl").val(t);$("#brightnessValue").html(t+"%");$("#brightnessControl").change(function(){$("#Loader").show();const n=mapValue($(this).val(),0,100,2,32);$.post("Brightness",{Value:n},function(){$("#Loader").hide()},"JSON")});pauseButton(n.Response.Pause)},"JSON")}console.log("ready!");const t={pl:{languageName:"pl",on:"On",off:"Off",module:"Moduł",moduleSetting:"Ustawienia Modułów",options:"Opcje"},en:{languageName:"en",on:"On",off:"Off",module:"Module",moduleSetting:"Module Setting",options:"Options"}};let n=t.en;navigator.language=="pl-PL"&&(n=t.pl);f();i();r();u();M.AutoInit();$("#moduleList").sortable({axis:"y",containment:$("#moduleList").parent(),cursor:"grabbing",delay:150,stop:function(){$("#Loader").show();const n=[];$("#moduleList li").each(function(){n.push($(this).find("form").serializeArray()[0].value)});$.post("sortModules",{order:n},function(){$("#Loader").hide()});console.log(n)}});$("#moduleList").disableSelection();$("#nextModuleBtn").click(function(){$.post("nextModule",function(){},"JSON")});$("#pauseBtn").click(function(){$.post("pause",function(n){pauseButton(n.Response.Pause)},"JSON")});$("#stopBtn").click(function(){$.post("shutdown",{hard:"false"},function(){},"JSON")});$("#shutdownBtn").click(function(){$.post("shutdown",{hard:"true"},function(){},"JSON")});$("#reloadBtn").click(function(){$.post("shutdown",{hard:"restart"},function(){},"JSON")})});